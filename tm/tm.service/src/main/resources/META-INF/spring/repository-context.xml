<?xml version="1.0" encoding="UTF-8"?>
<!--

        This file is part of the Squashtest platform.
        Copyright (C) 2010 - 2012 Henix, henix.fr

        See the NOTICE file distributed with this work for additional
        information regarding copyright ownership.

        This is free software: you can redistribute it and/or modify
        it under the terms of the GNU Lesser General Public License as published by
        the Free Software Foundation, either version 3 of the License, or
        (at your option) any later version.

        this software is distributed in the hope that it will be useful,
        but WITHOUT ANY WARRANTY; without even the implied warranty of
        MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
        GNU Lesser General Public License for more details.

        You should have received a copy of the GNU Lesser General Public License
        along with this software.  If not, see <http://www.gnu.org/licenses/>.

-->
<beans xmlns="http://www.springframework.org/schema/beans" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xmlns:context="http://www.springframework.org/schema/context" xmlns:aop="http://www.springframework.org/schema/aop"
	xmlns:util="http://www.springframework.org/schema/util" xmlns:tx="http://www.springframework.org/schema/tx"
	xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd
  	http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context-3.0.xsd
  	http://www.springframework.org/schema/aop http://www.springframework.org/schema/aop/spring-aop-3.0.xsd
	http://www.springframework.org/schema/util http://www.springframework.org/schema/util/spring-util-3.0.xsd
	http://www.springframework.org/schema/tx http://www.springframework.org/schema/tx/spring-tx-3.0.xsd">

	<tx:annotation-driven transaction-manager="squashtest.tm.hibernate.TransactionManager" order="1"/>
	
	<!-- ====== RDBMS / ORM INTEGRATION ====== -->
	 <bean id="defaultLobHandler" class="org.springframework.jdbc.support.lob.DefaultLobHandler" />
	 
	
	<bean id="squashtest.tm.persistence.hibernate.SessionFactory" class="org.springframework.orm.hibernate3.annotation.AnnotationSessionFactoryBean">
		<property name="dataSource" ref="squashtest.core.persistence.jdbc.DataSource" />
		<property name="annotatedPackages">
			<list>
				<value>org.squashtest.csp.tm.internal.repository.hibernate</value>
				<value>org.squashtest.csp.tm.internal.infrastructure.hibernate</value>
			</list>
		</property>
		<property name="annotatedClasses">
			<list>
				<value>org.squashtest.csp.tm.domain.testcase.TestCaseLibrary</value>
				<value>org.squashtest.csp.tm.domain.testcase.TestCaseLibraryNode</value>
				<value>org.squashtest.csp.tm.domain.testcase.TestCaseFolder</value>
				<value>org.squashtest.csp.tm.domain.testcase.TestCase</value>
				<value>org.squashtest.csp.tm.domain.testcase.TestStep</value>
				<value>org.squashtest.csp.tm.domain.testcase.ActionTestStep</value>
				<value>org.squashtest.csp.tm.domain.testcase.CallTestStep</value>

				<value>org.squashtest.csp.tm.domain.requirement.RequirementLibrary</value>
				<value>org.squashtest.csp.tm.domain.requirement.Requirement</value>
				<value>org.squashtest.csp.tm.domain.requirement.RequirementLibraryNode</value>
				<value>org.squashtest.csp.tm.domain.requirement.RequirementFolder</value>

				<value>org.squashtest.csp.tm.domain.resource.Resource</value>
				<value>org.squashtest.csp.tm.domain.resource.SimpleResource</value>
				<value>org.squashtest.csp.tm.domain.requirement.RequirementVersion</value>
				
				<value>org.squashtest.csp.tm.domain.campaign.CampaignLibrary</value>
				<value>org.squashtest.csp.tm.domain.campaign.Campaign</value>
				<value>org.squashtest.csp.tm.domain.campaign.CampaignLibraryNode</value>
				<value>org.squashtest.csp.tm.domain.campaign.CampaignFolder</value>
				<value>org.squashtest.csp.tm.domain.campaign.Iteration</value>
				<value>org.squashtest.csp.tm.domain.campaign.IterationTestPlanItem</value>
				<value>org.squashtest.csp.tm.domain.campaign.CampaignTestPlanItem</value>
				<value>org.squashtest.csp.tm.domain.campaign.TestSuite</value>

				<value>org.squashtest.csp.tm.domain.execution.Execution</value>
				<value>org.squashtest.csp.tm.domain.execution.ExecutionStep</value>
				
				<value>org.squashtest.csp.tm.domain.projectfilter.ProjectFilter</value>

				<value>org.squashtest.csp.tm.domain.audit.AuditableSupport</value>
				<value>org.squashtest.csp.tm.domain.softdelete.SoftDeletableSupport</value>
				
		        <value>org.squashtest.csp.tm.domain.project.GenericProject</value>
				<value>org.squashtest.csp.tm.domain.project.Project</value>
		        <value>org.squashtest.csp.tm.domain.project.ProjectTemplate</value>
				
				<value>org.squashtest.csp.tm.domain.projectfilter.ProjectFilter</value>
				
				<value>org.squashtest.csp.tm.domain.attachment.AttachmentList</value>
				<value>org.squashtest.csp.tm.domain.attachment.Attachment</value>
				<value>org.squashtest.csp.tm.domain.attachment.AttachmentContent</value>
				
				<value>org.squashtest.csp.core.bugtracker.domain.BugTracker</value>
				<value>org.squashtest.csp.tm.domain.bugtracker.BugTrackerBinding</value>
				
				<value>org.squashtest.csp.tm.domain.bugtracker.IssueList</value>
				<value>org.squashtest.csp.tm.domain.bugtracker.Issue</value>
				
				<value>org.squashtest.csp.tm.domain.users.User</value>
				<value>org.squashtest.csp.tm.domain.users.UsersGroup</value>
				
				<value>org.squashtest.csp.tm.domain.event.RequirementAuditEvent</value>
				<value>org.squashtest.csp.tm.domain.event.RequirementCreation</value>
				<value>org.squashtest.csp.tm.domain.event.RequirementPropertyChange</value>
				<value>org.squashtest.csp.tm.domain.event.RequirementLargePropertyChange</value>
				
				<!--  the following entries come from fragment tm.testautomation.api (except for the TA execution) -->
				<value>org.squashtest.csp.tm.domain.testautomation.TestAutomationServer</value>
				<value>org.squashtest.csp.tm.domain.testautomation.TestAutomationProject</value>
				<value>org.squashtest.csp.tm.domain.testautomation.AutomatedTest</value>
				<value>org.squashtest.csp.tm.domain.testautomation.AutomatedSuite</value>
				<value>org.squashtest.csp.tm.domain.testautomation.AutomatedExecutionExtender</value>

		        <!-- Custom Fields -->
		        <value>org.squashtest.csp.tm.domain.customfield.CustomField</value>
		        <value>org.squashtest.csp.tm.domain.customfield.SingleSelectField</value>
		        <value>org.squashtest.csp.tm.domain.customfield.CustomFieldOption</value>
		        <value>org.squashtest.csp.tm.domain.customfield.CustomFieldBinding</value>
		        <value>org.squashtest.csp.tm.domain.customfield.CustomFieldValue</value>
    		</list>
		</property>
		<property name="namingStrategy">
			<bean class="org.squashtest.csp.tm.internal.infrastructure.hibernate.UppercaseUnderscoreNamingStrategy" />
		</property>
		<property name="entityInterceptor">
			<bean class="org.squashtest.csp.tm.internal.infrastructure.hibernate.AuditLogInterceptor" />
		</property>
		<property name="hibernateProperties" ref="squashtest.tm.hibernate.config" />
		
		<property name="lobHandler" ref="defaultLobHandler"/>
	</bean>

	<bean id="squashtest.tm.hibernate.TransactionManager" class="org.springframework.orm.hibernate3.HibernateTransactionManager">
		<property name="sessionFactory" ref="squashtest.tm.persistence.hibernate.SessionFactory" />
	</bean>	
	<!-- ====== / RDBMS / ORM INTEGRATION ====== -->
	
	<!-- Dynamic Daos -->
  <bean id="projectDao" class="org.squashtest.tm.core.dynamicmanager.factory.DynamicDaoFactoryBean">
    <property name="componentType" value="org.squashtest.csp.tm.internal.repository.ProjectDao" />
    <property name="entityType" value="org.squashtest.csp.tm.domain.project.Project" />
  </bean> 
  
  <bean id="projectTemplateDao" class="org.squashtest.tm.core.dynamicmanager.factory.DynamicDaoFactoryBean">
    <property name="componentType" value="org.squashtest.csp.tm.internal.repository.ProjectTemplateDao" />
    <property name="entityType" value="org.squashtest.csp.tm.domain.project.ProjectTemplate" />
  </bean> 

  <bean id="genericProjectDao" class="org.squashtest.tm.core.dynamicmanager.factory.DynamicDaoFactoryBean">
    <property name="componentType" value="org.squashtest.csp.tm.internal.repository.GenericProjectDao" />
    <property name="entityType" value="org.squashtest.csp.tm.domain.project.GenericProject" />
  </bean> 

	<bean id="requirementAuditEventDao" class="org.squashtest.tm.core.dynamicmanager.factory.DynamicDaoFactoryBean">
		<property name="componentType" value="org.squashtest.csp.tm.internal.repository.RequirementAuditEventDao" />
		<property name="entityType" value="org.squashtest.csp.tm.domain.event.RequirementAuditEvent" />
	</bean>	
	
	<bean id="requirementVersionDao" class="org.squashtest.tm.core.dynamicmanager.factory.DynamicDaoFactoryBean">
		<property name="componentType" value="org.squashtest.csp.tm.internal.repository.RequirementVersionDao" />
		<property name="entityType" value="org.squashtest.csp.tm.domain.requirement.RequirementVersion" />
	</bean>	
	
	<bean id="testSuiteDao" class="org.squashtest.tm.core.dynamicmanager.factory.DynamicDaoFactoryBean">
		<property name="componentType" value="org.squashtest.csp.tm.internal.repository.TestSuiteDao" />
		<property name="entityType" value="org.squashtest.csp.tm.domain.campaign.TestSuite" />
	</bean>	
	<bean id="actionTestStepDao" class="org.squashtest.tm.core.dynamicmanager.factory.DynamicDaoFactoryBean">
		<property name="componentType" value="org.squashtest.csp.tm.internal.repository.ActionTestStepDao" />
		<property name="entityType" value="org.squashtest.csp.tm.domain.testcase.ActionTestStep" />
	</bean>	

	<bean id="automatedExecutionDao" class="org.squashtest.tm.core.dynamicmanager.factory.DynamicDaoFactoryBean">
		<property name="componentType" value="org.squashtest.csp.tm.internal.repository.testautomation.AutomatedExecutionExtenderDao" />
		<property name="entityType" value="org.squashtest.csp.tm.domain.testautomation.AutomatedExecutionExtender" />
	</bean>	
	
	<bean id="customFieldDao" class="org.squashtest.tm.core.dynamicmanager.factory.DynamicDaoFactoryBean">
		<property name="componentType" value="org.squashtest.csp.tm.internal.repository.CustomFieldDao" />
		<property name="entityType" value="org.squashtest.csp.tm.domain.customfield.CustomField" />
	</bean>	
	
	<bean id="customFieldBindingDao" class="org.squashtest.tm.core.dynamicmanager.factory.DynamicDaoFactoryBean">
		<property name="componentType" value="org.squashtest.csp.tm.internal.repository.CustomFieldBindingDao" />
		<property name="entityType" value="org.squashtest.csp.tm.domain.customfield.CustomFieldBinding" />
	</bean>		
	
	<bean id="customFieldValueDao" class="org.squashtest.tm.core.dynamicmanager.factory.DynamicDaoFactoryBean">
		<property name="componentType" value="org.squashtest.csp.tm.internal.repository.CustomFieldValueDao" />
		<property name="entityType" value="org.squashtest.csp.tm.domain.customfield.CustomFieldValue" />
	</bean>		
	
	
</beans>

