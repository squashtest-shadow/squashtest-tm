<!--

        This file is part of the Squashtest platform.
        Copyright (C) 2010 - 2012 Henix, henix.fr

        See the NOTICE file distributed with this work for additional
        information regarding copyright ownership.

        This is free software: you can redistribute it and/or modify
        it under the terms of the GNU Lesser General Public License as published by
        the Free Software Foundation, either version 3 of the License, or
        (at your option) any later version.

        this software is distributed in the hope that it will be useful,
        but WITHOUT ANY WARRANTY; without even the implied warranty of
        MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
        GNU Lesser General Public License for more details.

        You should have received a copy of the GNU Lesser General Public License
        along with this software.  If not, see <http://www.gnu.org/licenses/>.

-->
<!DOCTYPE html SYSTEM "http://www.thymeleaf.org/dtd/xhtml1-transitional-thymeleaf-spring3-3.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:th="http://www.thymeleaf.org">
<head>
	<title th:text="#{workspace.report.title}">Espace rapports</title>
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
	<!-- common head -->
	<link rel="stylesheet" type="text/css" media="all" href="../../../../../../../core/core.web/src/main/webapp/styles/master.css" />
	<link rel="shortcut icon" type="image/x-icon" media="all" href="../../../../../../../core/core.web/src/main/webapp/images/favicon.ico" th:href="@{/images/favicon.ico}"/>
	<!-- /common head -->
	<!-- common script import -->
	<link rel="stylesheet" type="text/css" media="all" href="../../../../../../../core/core.web/src/main/webapp/styles/squashtm.fg.menu.css" />
	<!-- /common script import -->
	<link rel="stylesheet" type="text/css" media="all" href="../../../../../../../core/core.web/src/main/webapp/styles/master.blue.css" />
	<!-- rich jeditable header -->
	<link rel="stylesheet" type="text/css" media="all" href="../../../../../../../core/core.web/src/main/webapp/styles/ckeditor.override.css" />

	<div th:remove="all">
		<script type="text/javascript" src="../../scripts/lib/jquery/jquery-1.8.2.js" th:src="@{/scripts/lib/jquery/jquery-1.8.2.min.js}"></script>
		<script type="text/javascript" src="../../scripts/lib/jquery/jquery-ui-1.9.0.custom.js" th:src="@{/scripts/lib/jquery/jquery-ui-1.9.0.custom.min.js}"></script>
		<script type="text/javascript" src="../../scripts/ckeditor/ckeditor.js" th:src="@{/scripts/ckeditor/ckeditor.js}"></script>
		<script type="text/javascript" src="../../scripts/ckeditor/adapters/jquery.js" th:src="@{/scripts/ckeditor/adapters/jquery.js}"></script>
		<script type="text/javascript" src="../../scripts/jquery/jquery.jeditable.js" th:src="@{/scripts/jquery/jquery.jeditable.js}"></script>
		<script type="text/javascript" src="../../scripts/jquery/jquery.generateId.js" th:src="@{/scripts/jquery/jquery.generateId.js}"></script>
		<script type="text/javascript" src="../../scripts/jquery/jquery.jeditable.ckeditor.js" th:src="@{/scripts/jquery/jquery.jeditable.ckeditor.js}"></script>
		<script type="text/javascript" src="../../scripts/jquery/jquery.jeditable.datepicker.js" th:src="@{/scripts/jquery/jquery.jeditable.datepicker.js}"></script>
		<script type="text/javascript" src="../../scripts/jquery/jquery.cookie.js" th:src="@{/scripts/jquery/jquery.cookie.js}"></script>
		<script type="text/javascript" src="../../scripts/jquery/jquery.hotkeys-0.8.js" th:src="@{/scripts/jquery/jquery.hotkeys-0.8.js}"></script>
		<script type="text/javascript" src="../../scripts/jquery/jquery.jstree.js" th:src="@{/scripts/jquery/jquery.jstree.js}"></script>
		<script type="text/javascript" src="../../scripts/datatables/jquery.dataTables.js"></script>
		<script type="text/javascript" src="../../scripts/squashtest/jquery.squashtm.plugin.js" th:src="@{/scripts/squashtest/jquery.squashtm.plugin.js}"></script>
		<script type="text/javascript" src="../../scripts/squashtest/jquery.squash.togglepanels.js" th:src="@{/scripts/squashtest/jquery.squash.togglepanels.js}"></script> 
		<script type="text/javascript" src="../../scripts/squashtest/jquery.squash.messagedialog.js" th:src="@{/scripts/squashtest/jquery.squash.messagedialog.js}"></script>  
		<script type="text/javascript" src="../../scripts/squashtest/jquery.squash.confirmdialog.js" th:src="@{/scripts/squashtest/jquery.squash.confirmdialog.js}"></script>  
		<script type="text/javascript" src="../../scripts/squashtest/jquery.squashtm.oneshotdialog.js" th:src="@{/scripts/squashtest/jquery.squashtm.oneshotdialog.js}"></script>
		<script type="text/javascript" src="../../scripts/squashtest/classes/KeyEventListener.js" th:src="@{/scripts/squashtest/classes/KeyEventListener.js}"></script>
		<script type="text/javascript" src="../../scripts/squashtest/jquery.squashtm.contextual-content.js" th:src="@{/scripts/squashtest/jquery.squashtm.contextual-content.js}"></script>
		<script type="text/javascript" src="../../scripts/squashtest/jquery.squashtm.fg.menu.js" th:src="@{/scripts/squashtest/jquery.squashtm.fg.menu.js}"></script>
		<script type="text/javascript" src="../../scripts/squashtest/classes/Event.js" th:src="@{/scripts/squashtest/classes/Event.js}"></script>
		<script type="text/javascript" src="../../scripts/squashtest/jquery.squash.squashbutton.js" th:src="@{/scripts/squashtest/jquery.squash.squashbutton.js}"></script>
		<script type="text/javascript" src="../../scripts/squashtest/jquery.squashtm.jeditable.ext.js" th:src="@{/scripts/squashtest/jquery.squashtm.jeditable.ext.js}"></script>
		<script type="text/javascript" src="../../scripts/squashtest/classes/TreeEventHandler.js" th:src="@{/scripts/squashtest/classes/TreeEventHandler.js}"></script>
		<script type="text/javascript" src="../../scripts/squashtest/classes/TreeNodeCopier.js" th:src="@{/scripts/squashtest/classes/TreeNodeCopier.js}"></script>
		<script type="text/javascript" src="../../scripts/squashtest/jquery.squashtm.jstree-node.js" th:src="@{/scripts/squashtest/jquery.squashtm.jstree-node.js}"></script>
		<script type="text/javascript" src="../../scripts/squashtest/jquery.squashtm.jstree.ext.js" th:src="@{/scripts/squashtest/jquery.squashtm.jstree.ext.js}"></script>
		<script type="text/javascript" src="../../scripts/squash/jquery.squashtm.linkabletree.js" th:src="@{/scripts/squash/jquery.squashtm.linkabletree.js}"></script>
		<script type="text/javascript" src="../../scripts/squash/jquery.squashtm.projectpicker.js" th:src="@{/scripts/squash/jquery.squashtm.projectpicker.js}"></script>
		<script type="text/javascript" src="../../scripts/squash/squashtm.navbar.js" th:src="@{/scripts/squash/squashtm.navbar.js}"></script>
	</div>

	<script th:remove="all" type="text/javascript" src="../../js/thymol.js"></script>
	<script type="text/javascript" src="../../scripts/squash/squashtm.navbar.js"></script>
	<script type="text/javascript" src="../../scripts/squash/squashtm.projectfilter.js"></script>

	<script type="text/javascript" src="../../scripts/squash/squashtm.reportworkspace.js" th:src="@{/scripts/squash/squashtm.reportworkspace.js}"></script>
	<script type="text/javascript" src="../../scripts/squash/squashtm.report.js" th:src="@{/scripts/squash/squashtm.report.js}"></script>

	<script type="text/javascript" th:inline="javascript">
		$(function() {
			/* navigation tag */
			squashtm.navbar.initHighlighted('report');
			var workspaceUrl = document.location.protocol + '//' + document.location.host + "/squash/bugtracker/workspace-button";
			$("#bugtracker-div").load(workspaceUrl,
		 			function(){$("#bugtracker-link").hover(
		 						function () {squashtm.navbar.highlightOn("bugtracker-link");}, 
		 						function () {squashtm.navbar.highlightOff("bugtracker-link");}
	 	 		);
	 		});
				
			squashtm.reportWorkspace.init();
		});	
	</script>
</head>
<body>
	<div id="navigation" th:include="navbar.frag :: navbar">
		NAVBAR
	</div>

	<div id="workspace">
		<div id="workspace-title">
			<div class="snap-left">
				<h2 th:text="#{workspace.report.title}">Espace Rapport</h2>	
			</div>
			<div class="snap-right">
 				<div class="main-menubar">
 					MENUBAR
				</div>
			</div>
		</div>
		
		<div id="category-pane">
			<div id="outer-category-frame">
				<div title="Cat 1" class="report-category">
					<div data-href="sample-report/0" class="report-item">
						<div class="report-item-icon">
							<img src="../../../../../../../core/core.web/src/main/webapp/images/report_spreadsheet.png" alt="report" />
						</div> 
						<div class="report-item-description">
							<label><b>Sample report</b><br/><b>(Sample type)</b></label><br/>
							<span>This report does this and that</span>
						</div>
						<div class="unsnap"></div>
					</div>
				</div>
			</div> 
 		</div>
<!-- TAB -->
		<div id="contextual-content" class="no-resizable-contextual-content" th:fragment="tab">
			<table id="execs-table">
				<thead>
					<tr>
						<th class="not-displayed">Id</th>
						<th th:text="#{label.Project}">Project</th>
						<th th:text="#{label.Campaign}">Campaign</th>
						<th th:text="#{label.iteration}">Iteration</th>
						<th th:text="#{label.execution}">Execution</th>
						<th th:text="#{label.execution.mode}">Mode</th>
						<th th:text="#{label.testSuite}">Test suite</th>
						<th class="not-displayed">Raw status</th>
						<th th:text="#{label.execution.status}">Status</th>
						<th th:text="#{label.execution.lastRunnedBy}">Runned by</th>
						<th th:text="#{label.execution.lastRunnedOn}">Runned on</th>
					</tr>
				</thead>
				<tbody>
					<tr th:each="exec : ${execs}" th:object="${exec}">
						<td th:text="*{id}" class="not-displayed exec-id">1</td>
						<td th:text="*{testPlan.iteration.project.name}">Project XX</td>
						<td th:text="*{testPlan.iteration.campaign.name}">Campaign YY</td>
						<td th:text="*{testPlan.iteration.name}">Iteration YY</td>
						<td class="exec-name"><a href="/executions/1/info" th:href="@{'/executions/'} + *{id}" th:text="*{name}">Execution ZZ</a></td>
						<td th:text="#{*{executionMode.i18nKey}}">Mode ??</td>
						<td th:text="*{testPlan.testSuite} ? *{testPlan.testSuite.name} : ''">Test Suite AA</td>
						<td th:text="*{executionStatus}"  class="not-displayed raw-exec-status">BLOCKED</td>
						<td th:text="#{*{executionStatus.i18nKey}}" class="exec-status exec-status-blocked" th:class="*{'exec-status exec-status-' + #strings.toLowerCase(executionStatus)}">Status ??</td>
						<td th:text="*{lastExecutedBy}">Peter Parker</td>
						<td th:text="*{lastExecutedOn == null ? #messages.msg('squashtm.nodata') : #dates.format(lastExecutedOn,#messages.msg('squashtm.dateformatShort'))}">01/02/2013</td>
					</tr>
					<tr th:remove="all">
						<td class="not-displayed exec-id">1</td>
						<td>Project XX</td>
						<td>Campaign YY</td>
						<td>Iteration YY</td>
						<td class="exec-name"><a href="/executions/1/info">Execution ZZ</a></td>
						<td>Mode ??</td>
						<td>Test Suite AA</td>
						<td class="not-displayed raw-exec-status">RUNNING</td>
						<td class="exec-status exec-status-running">Status ??</td>
						<td>Peter Parker</td>
						<td>01/02/2013</td>
					</tr>
				</tbody>
			</table>
		</div>
<!-- /TAB FRAGMENT -->
<!-- SCRIPT FRAGMENT -->
		<div th:fragment="script">
		<script type="text/javascript" th:inline="javascript">
		/* <![CDATA[ */
			$(function(){
				var execUrlRoot = /*[[ @{/executions} ]]*/ "http://localhost:8080/squash/executions";
				
				function addExecutionLink(row, data) {
					var id = data["exec-id"];
					var nameCell = row.find("td.exec-name");
					var name = data["exec-name"];
					var href = execUrlRoot + "/" + id;
					nameCell.html('<a href="' + href + '">' + name + '</a>');
				}				
				
				function addStatusBall(row, data) {
					var status = data["raw-exec-status"].toLowerCase();
					row.find("td.exec-status").addClass("exec-status-" + status);
				}			
				
				function drawExecutionRow(nRow, aData, iDisplayIndex, iDisplayIndexFull) {
					var row = $(nRow);
					addExecutionLink(row, aData);
					addStatusBall(row, aData);
				}
				
				var table = $("#execs-table").dataTable({
					"oLanguage": {
						"sUrl": /*[[ @{/datatables/messages} ]]*/ "http://localhost:8080/squash/datatables/messages"
					},
					"bJQueryUI": true,
					"bAutoWidth": false,
					"bFilter": false,
					"bPaginate": true,
					"sPaginationType": "squash",
					"iDisplayLength": /*[[ ${executionsPageSize} ]]*/ 50,
					"bProcessing": true,
					"bServerSide": true,
					"sAjaxSource": /*[[ @{'/test-cases/' + ${testCaseId} + '/executions'} ]]*/ "http://localhost:8080/squash/test-cases/1/executions",
					"bDeferRender": true,
					"bRetrieve": true,				
					"sDom": 't<"dataTables_footer"lirp>',
 					"iDeferLoading": /*[[ ${#lists.size(execs)} ]]*/ 1,
			        "aaSorting": [ [ 10, "desc" ] ],
			        "fnRowCallback": drawExecutionRow,
					"aoColumnDefs": [ 
						{ "bVisible": false, "aTargets": [0], "sClass": "exec-id", "mDataProp": "exec-id" },
						{ "bSortable": true, "aTargets": [1], "mDataProp": "project-name" },
						{ "bSortable": true, "aTargets": [2], "mDataProp": "campaign-name" },
						{ "bSortable": true, "aTargets": [3], "mDataProp": "iteration-name" },
						{ "bSortable": true, "aTargets": [4], "sClass": "exec-name", "mDataProp": "exec-name" },
						{ "bSortable": true, "aTargets": [5], "mDataProp": "exec-mode" },
						{ "bSortable": true, "aTargets": [6], "mDataProp": "test-suite-name" },
						{ "bVisible": false, "aTargets": [7], "sClass": "raw-exec-status", "mDataProp": "raw-exec-status" },
						{ "bSortable": true, "aTargets": [8], "sClass": "exec-status", "mDataProp": "exec-status" },
						{ "bSortable": true, "aTargets": [9], "mDataProp": "last-exec-by" },
						{ "bSortable": true, "aTargets": [10], "mDataProp": "last-exec-on" }
					] 
				});	
			});
	    	/* ]]> */
		</script>		
		</div>
<!-- /SCRIPT FRAGMENT -->
	</div>
</body>
</html>
