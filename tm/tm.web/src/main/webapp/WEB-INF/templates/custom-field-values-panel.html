<!--

        This file is part of the Squashtest platform.
        Copyright (C) 2010 - 2012 Henix, henix.fr

        See the NOTICE file distributed with this work for additional
        information regarding copyright ownership.

        This is free software: you can redistribute it and/or modify
        it under the terms of the GNU Lesser General Public License as published by
        the Free Software Foundation, either version 3 of the License, or
        (at your option) any later version.

        this software is distributed in the hope that it will be useful,
        but WITHOUT ANY WARRANTY; without even the implied warranty of
        MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
        GNU Lesser General Public License for more details.

        You should have received a copy of the GNU Lesser General Public License
        along with this software.  If not, see <http://www.gnu.org/licenses/>.

-->

<div th:remove="all">
	<!--  documentation : 
			Parameters :
				- a CustomFieldValueConfigurationBean, named 'configuration'
				- a boolean named 'editable' saying whether those values are editable. 
	 -->
			<!-- 
			<div th:text="${confBean.value}" th:if="${confBean.inputType != 'CHECKBOX'}">maximale</div>
			<input disabled="disabled" type="checkbox" class="display-table-cell" checked="checked" th:if="${confBean.inputType == 'CHECKBOX' and  confBean.valueAsBoolean}" />
			<input disabled="disabled" type="checkbox" class="display-table-cell"  th:if="${confBean.inputType == 'CHECKBOX' and  ! confBean.valueAsBoolean}" />
			 -->
</div>


<div th:remove="all">
<script type="text/javascript">
	var require = { 
	    baseUrl: '../../scripts/'
	}; 
</script>
<script type="text/javascript" src="../../scripts/lib/jquery/jquery-1.8.2.js"></script>
<script type="text/javascript" src="../../js/thymol.js"></script>
<script type="text/javascript" src="../../scripts/require.js"></script>
<script type="text/javascript" src="../../scripts/common.js"></script>

<link rel="stylesheet" type="text/css" media="all" href="../../../../../../../core/core.web/src/main/webapp/styles/master.css" th:href="@{/styles/master.css}" />
<link rel="shortcut icon" type="image/x-icon" media="all" href="../../../../../../../core/core.web/src/main/webapp/images/favicon.ico" th:href="@{/images/favicon.ico}"/>
<link rel="stylesheet" type="text/css" media="all" href="../../../../../../../core/core.web/src/main/webapp/styles/squashtm.fg.menu.css" th:href="@{/styles/squashtm.fg.menu.css}" />
<link rel="stylesheet" type="text/css" media="all" href="../../../../../../../core/core.web/src/main/webapp/styles/master.blue.css" th:href="@{/styles/master.blue.css}" />
<link rel="stylesheet" type="text/css" media="all" href="../../../../../../../core/core.web/src/main/webapp/styles/ckeditor.override.css" th:href="@{/styles/ckeditor.override.css}" />

</div>

<div id="custom-field-values" >
	
	<div class="display-table">
		<div class="display-table-row" th:each="confBean : ${configuration.configurationBeans}">
			<label class="display-table-cell" th:text="${confBean.fieldName}">quantité de café</label>
			<div class="display-table-cell" th:switch="${confBean.type}">
				<input type="checkbox" disabled="disabled" th:case="'checkbox'" th:checked="${confBean.valueAsBoolean}"/>
				<span th:case="*" th:text="${confBean.fieldValue}">maximum</span>
			</div>
		</div>
	</div>
	
	<script th:if="${editable}" type="text/javascript" th:inline="javascript">
		//<![CDATA[
			require(['domReady', 'jquery'], function(domReady, $){
				
				var imgUrl = /*[[@{/scripts/jquery/indicator.gif}]]*/"../../scripts/jquery/indicator.gif";
				
				var baseConf = {
					submit : /*[[#{rich-edit.button.ok.label}]]*/"ok",
					cancel : /*[[#{label.Cancel}]]*/"cancel",
					placeholder : /*[[#{rich-edit.placeholder}]]*/"say something",
					cols: 80,
					max_size: 20, 
					onblur : function(){},		
					maxlength : 255,
					indicator : '<img src="'+imgUrl+'" alt="processing..." />'
				};	
				
				var postFunction = function(value, settings){
					var cfurl = /*[[@{/custom-fields/values}+'/']]*/"http://localhost:8080/squash/custom-fields/values/";
					var url = cfurl+settings.fieldId;
					$.post(url, {value : value});
					return value;
				}
				
				var settings = /*[[${configuration.configurationBeans}]]*/ [];
				
				domReady( function(){
					
					var widgets = $("#custom-field-values div.display-table-cell *");
					widgets.addClass("editable");
					
					var count = widgets.length;
					
					for (var i =0;i<count;i++){
						
						var widget = widgets.eq(i);
						var conf = settings[i];
						
						//non-jeditable inputs
						if (conf.type==='checkbox'){
							widget.prop('disabled', false);
							widget.change(function(){
								postFunction(this.checked, conf);
							});
						}
						//jeditable inputs
						else{
							var effective = $.extend({}, baseConf, conf);
							widget.editable(postFunction, effective);							
						}
					}					
				});			
			});
		//]]>
	</script> 
	
</div>


<div th:fragment="plain-text" th:remove="all">
	alert('toto');
</div>


<div th:fragment="checkbox" th:remove="all">
	alert('titi');
</div>