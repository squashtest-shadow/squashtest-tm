<!--

        This file is part of the Squashtest platform.
        Copyright (C) 2010 - 2012 Henix, henix.fr

        See the NOTICE file distributed with this work for additional
        information regarding copyright ownership.

        This is free software: you can redistribute it and/or modify
        it under the terms of the GNU Lesser General Public License as published by
        the Free Software Foundation, either version 3 of the License, or
        (at your option) any later version.

        this software is distributed in the hope that it will be useful,
        but WITHOUT ANY WARRANTY; without even the implied warranty of
        MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
        GNU Lesser General Public License for more details.

        You should have received a copy of the GNU Lesser General Public License
        along with this software.  If not, see <http://www.gnu.org/licenses/>.

-->

<div th:remove="all">
	<!--  documentation : 
			Parameters :
				- needs the list of all the custom field bindings grouped by BindableEntity, for 1 project.
				namely : requirementBindings, testCaseBindings, campaignBindings, iterationBindings, testSuiteBindings
	 -->

</div>


<div th:remove="all">
<script type="text/javascript">
	var require = { 
	    baseUrl: '../../scripts/'
	}; 
</script>
<script type="text/javascript" src="../../scripts/lib/jquery/jquery-1.8.2.js"></script>
<script type="text/javascript" src="../../js/thymol.js"></script>
<script type="text/javascript" src="../../scripts/require.js"></script>
<script type="text/javascript" src="../../scripts/common.js"></script>

<link rel="stylesheet" type="text/css" media="all" href="../../../../../../../tm/tm.web/src/main/webapp/styles/master.css" th:href="@{/styles/master.css}" />
<link rel="shortcut icon" type="image/x-icon" media="all" href="../../../../../../../tm/tm.web/src/main/webapp/images/favicon.ico" th:href="@{/images/favicon.ico}"/>
<link rel="stylesheet" type="text/css" media="all" href="../../../../../../../tm/tm.web/src/main/webapp/styles/squashtm.fg.menu.css" th:href="@{/styles/squashtm.fg.menu.css}" />
<link rel="stylesheet" type="text/css" media="all" href="../../../../../../../tm/tm.web/src/main/webapp/styles/master.blue.css" th:href="@{/styles/master.grey.css}" />
<link rel="stylesheet" type="text/css" media="all" href="../../../../../../../tm/tm.web/src/main/webapp/styles/ckeditor.override.css" th:href="@{/styles/ckeditor.override.css}" />

</div>


<div id="cuf-binding-administration">

<div id="requirements-binding-manager" th:include="custom-field-binding :: cuf-unit-binder" th:with="HTMLID='requirements',collection=${requirementBindings}">
</div>

<div id="test-cases-binding-manager" th:include="custom-field-binding :: cuf-unit-binder" th:with="HTMLID='test-cases',collection=${testCaseBindings}">
</div>

<div id="test-steps-binding-manager" th:include="custom-field-binding :: cuf-unit-binder" th:with="HTMLID='test-steps',collection=${testStepBindings}">
</div>

<div id="campaigns-binding-manager" th:include="custom-field-binding :: cuf-unit-binder" th:with="HTMLID='campaigns',collection=${campaignBindings}">
</div>

<div id="iterations-binding-manager" th:include="custom-field-binding :: cuf-unit-binder" th:with="HTMLID='iterations',collection=${iterationBindings}">
</div>

<div id="test-suites-binding-manager" th:include="custom-field-binding :: cuf-unit-binder" th:with="HTMLID='test-suites',collection=${testSuiteBindings}">
</div>


<script type="text/javascript" th:inline="javascript">
//<![CDATA[

    require(["domReady", "require"],function(domReady, require){

    	var config = {
    		
    		general : {
	    		projectId : /*[[${projectIdentifier}]]*/10,	    			
	    		tableLanguageUrl: /*[[ @{/datatables/messages} ]]*/ "http://localhost:8080/squash/datatables/messages", 
	        	baseURL: /*[[ @{/custom-fields-binding} ]]*/ "http://localhost:8080/squash/custom-fields-binding",
	        	oklabel : /*[[ #{label.Yes} ]]*/ "ouaiche",
	        	cancellabel : /*[[ #{label.Cancel} ]]*/ "nope",
       			popupTitle : /*[[#{message.customfieldbinding.bind}]]*/'bind new custom fields',	        
	        },
    		
    		tcSettings : {
    			entityType : 'TEST_CASE', //should be @org.squashtest.tm.tm.domain.customfield.BindableEntity@TEST_CASE
    			mainSelector : "#test-cases-binding-manager", 
    			panelTitle : /*[[ #{project.cufbinding.test-cases.panel.title}  ]]*/"test case bindings",
    			tableDeferLoading : /*[[ ${testCaseBindings.size()} ]]*/ 3,	
       			tableDeleteMessage : /*[[#{message.customfieldbinding.unbind.message(#{label.customField.bindableEntity.TEST_CASE})}]]*/ "Retirer les champs personalisés sélectionnées de ce projet ?",
       			tableDeleteTooltip : /*[[#{message.customfieldbinding.unbind.tooltip}]]*/ 'retirer'
	    	},
	    	
    		tstepSettings : {
    			entityType : 'TEST_STEP', //should be @org.squashtest.tm.tm.domain.customfield.BindableEntity@TEST_STEP
    			mainSelector : "#test-steps-binding-manager", 
    			panelTitle : /*[[ #{project.cufbinding.test-steps.panel.title}  ]]*/"test step bindings",
    			tableDeferLoading : /*[[ ${testStepBindings.size()} ]]*/ 3,	
    			tableDeleteMessage : /*[[#{message.customfieldbinding.unbind.message(#{label.customField.bindableEntity.TEST_STEP})}]]*/ "Retirer les champs personalisés sélectionnées de ce projet ?",
    			tableDeleteTooltip : /*[[#{message.customfieldbinding.unbind.tooltip}]]*/ 'retirer'
    		},
	    	
    		reqSettings : {
    			entityType : 'REQUIREMENT_VERSION', //should be @org.squashtest.tm.tm.domain.customfield.BindableEntity@REQUIREMENT_VERSION
    			mainSelector : "#requirements-binding-manager", 
    			panelTitle : /*[[ #{project.cufbinding.requirements.panel.title}  ]]*/"requirements bindings",
    			tableDeferLoading : /*[[ ${requirementBindings.size()} ]]*/ 3,	
    			tableDeleteMessage : /*[[#{message.customfieldbinding.unbind.message(#{label.customField.bindableEntity.REQUIREMENT_VERSION})}]]*/ "Retirer les champs personalisés sélectionnées de ce projet ?",
    			tableDeleteTooltip : /*[[#{message.customfieldbinding.unbind.tooltip}]]*/ 'retirer'
	    	},
	    	
    		campSettings : {
    			entityType : 'CAMPAIGN', //should be @org.squashtest.tm.tm.domain.customfield.BindableEntity@CAMPAIGN
    			mainSelector : "#campaigns-binding-manager", 
    			panelTitle : /*[[ #{project.cufbinding.campaigns.panel.title}  ]]*/"campaign bindings",
    			tableDeferLoading : /*[[ ${campaignBindings.size()} ]]*/ 3,	
    			tableDeleteMessage : /*[[#{message.customfieldbinding.unbind.message(#{label.customField.bindableEntity.CAMPAIGN})}]]*/ "Retirer les champs personalisés sélectionnées de ce projet ?",
    			tableDeleteTooltip : /*[[#{message.customfieldbinding.unbind.tooltip}]]*/ 'retirer'
	    	},
	    	
    		iterSettings : {
    			entityType : 'ITERATION', //should be @org.squashtest.tm.tm.domain.customfield.BindableEntity@ITERATION
    			mainSelector : "#iterations-binding-manager", 
    			panelTitle : /*[[ #{project.cufbinding.iterations.panel.title}  ]]*/"iteration bindings",
    			tableDeferLoading : /*[[ ${iterationBindings.size()} ]]*/ 3,	
    			tableDeleteMessage : /*[[#{message.customfieldbinding.unbind.message(#{label.customField.bindableEntity.ITERATION})}]]*/ "Retirer les champs personalisés sélectionnées de ce projet ?",
    			tableDeleteTooltip : /*[[#{message.customfieldbinding.unbind.tooltip}]]*/ 'retirer'
	    	},
	    	
    		tsSettings : {
    			entityType : 'TEST_SUITE', //should be @org.squashtest.tm.tm.domain.customfield.BindableEntity@TEST_SUITE
    			mainSelector : "#test-suites-binding-manager", 
    			panelTitle : /*[[ #{project.cufbinding.test-suites.panel.title}  ]]*/"test suite bindings",
    			tableDeferLoading : /*[[ ${testSuiteBindings.size()} ]]*/ 3,	
    			tableDeleteMessage : /*[[#{message.customfieldbinding.unbind.message(#{label.customField.bindableEntity.TEST_SUITE})}]]*/ "Retirer les champs personalisés sélectionnées de ce projet ?",
    			tableDeleteTooltip : /*[[#{message.customfieldbinding.unbind.tooltip}]]*/ 'retirer'
	    	}
	    		    	
    	};

    	domReady(function(){
        	require(["custom-field-binding"], function(main){
        		main.setConfig(config).init();
        	});   		
    	});
    
    
    });

//]]>

</script>
</div>



<div th:remove="all">
<!--  ========================================================================== 
				TEMPLATE FRAGMENT DEFINITION + other stuffs removed at runtime
============================================================================ -->

	<div th:fragment="cuf-unit-binder" id="binding-manager">
		<div class="toggle-panel">
			<span class="not-displayed toggle-panel-buttons">
				<input type="button" th:value="#{ label.CustomField.add }" value="ajouter"/>
			</span>
			<div id="panel" th:id="${HTMLID}+'-binding-panel'" class="toggle-panel-main cuf-binding-panel">
			
				<table id="table" class="cuf-binding-table" th:id="${HTMLID}+'-binding-table'">
					<thead>
						<tr>
							<th>id</th>
							<th>#</th>
							<th th:text="#{project.cufbinding.table.name}">name</th>
							<th> </th>
						</tr>
					</thead>
					<tbody>
						<tr th:each="binding : ${collection}">
							<td th:text="${binding.id}">10</td>
							<td th:text="${binding.position}">1</td>
							<td th:text="${binding.customField.name}">bob</td>
							<td > </td>				
						</tr>
						<tr th:remove="all">
							<td>20</td>
							<td>2</td>
							<td>robert</td>
							<td> </td>		
						</tr>
						<tr th:remove="all">
							<td>30</td>
							<td>3</td>
							<td>mike</td>
							<td> </td>				
						</tr>
					</tbody>
				</table>
			
			</div>
		</div>
	
		
		<div id="popup" th:id="${HTMLID}+'-binding-popup'" class="popup-dialog cuf-binding-popup">
			
			<div class="component left-div dataTables_wrapper">
				<table class="dataTable">
					<thead>
						<tr>
							<th width="25px" class="th-check ui-state-default"></th>
							<th width="70px" class="th-name ui-state-default"  th:text="#{project.cufbinding.popup.table.name}">name</th>
							<th width="70px" class="th-type ui-state-default" th:text="#{project.cufbinding.popup.table.type}">type</th>
							<th width="70px" class="th-optional ui-state-default" th:text="#{project.cufbinding.popup.table.optional}">optional</th>
						</tr>
					</thead>
					<tbody class="available-fields">
						<tr th:remove="all">
							<td class="td-check" data-id="5"><input type="checkbox"/></td>
							<td class="td-name">text-field 5</td>
							<td class="td-type">text field</td>
							<td class="td-optional">yes</td>
						</tr>			
					</tbody>
					<tbody class="row-template-holder">
						<tr>
							<td class="td-check"><input type="checkbox"/></td>
							<td class="td-name"></td>
							<td class="td-type"></td>
							<td class="td-optional"></td>	
						</tr>				
					</tbody>
				</table>
			</div>
				
			<!-- TODO : some day 
			<div class="component right-div">
			</div>
			 -->
		</div>
	</div>
	
</div>

<div th:remove="all">
<link rel="stylesheet" type="text/css" href="../../scripts/custom-field-binding/cuf-binding-styles.css"/>
<script type="text/javascript" >
	/* code to tests the fragment. Note that it will not invoke the module 'squash.cuf-binding-manager', 
	but rather one of its submodules*/

   require(["domReady", "require"],function(domReady, require){
		
	   settings = {
    		projectId : 14,	    			
    		tableLanguageUrl:  "http://localhost:8080/squash/datatables/messages", 
        	baseURL: "http://localhost:8080/squash/custom-fields-binding",
        	oklabel : "ouaiche",
        	cancellabel : "nope",
        	confirmActionLabel : /*   */ "Retirer les champs personalisés sélectionnées de ce projet ?"
        	
    		entityType : 'TEST_CASE', 
   			mainSelector : '#binding-manager',
   			
   			panelTitle : "test case workspace",   			
   			tableDeferLoading : 3,   			
   			popupTitle : 'bind new custom fields',	
   			
   			tableDeleteMessage : "Retirer les champs personalisés sélectionnées de ce projet ?",
   			tableDeleteTooltip : 'retirer'
		};
				   
		domReady(function(){
			require(["custom-field-binding", "custom-field-binding/entity-manager"], function(main, EntityManager){
        		new EntityManager(settings);
        	});   				
		});
	   
   });
         
</script>
</div>