<!--

        This file is part of the Squashtest platform.
        Copyright (C) 2010 - 2015 Henix, henix.fr

        See the NOTICE file distributed with this work for additional
        information regarding copyright ownership.

        This is free software: you can redistribute it and/or modify
        it under the terms of the GNU Lesser General Public License as published by
        the Free Software Foundation, either version 3 of the License, or
        (at your option) any later version.

        this software is distributed in the hope that it will be useful,
        but WITHOUT ANY WARRANTY; without even the implied warranty of
        MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
        GNU Lesser General Public License for more details.

        You should have received a copy of the GNU Lesser General Public License
        along with this software.  If not, see <http://www.gnu.org/licenses/>.

-->


<div th:remove="tag">
  <!-- 
    This tag needs in the context an object MilestonePanelConfiguration named "conf"      
   -->
</div>


<div class="milestone-panel-master" 
th:with="isWritable = ${#authorization.expression('hasRole(''ROLE_ADMIN'')')  or sec.hasPermission(item , 'WRITE')}">
  
  <div class="toolbar" th:if="${isWritable}">
  
    <button class="sq-icon-btn btn-sm milestone-panel-bind-button" th:title="#{label.AssociateMilestoneToRequirement}" >
       <span class="ui-icon ui-icon-plus squared-icons">+</span>
    </button>
  
    <button class="sq-icon-btn btn-sm milestone-panel-unbind-button" th:title="#{label.DisssociateMilestoneToRequirement}">
       <span class="ui-icon ui-icon-minus squared-icons">-</span>
    </button>
    
  </div>

  <div class="table-tab-wrap">

    <div class="centered std-margin-top std-margin-bottom" th:if="${not conf.multilines}">
      <span th:text="#{message.OnlyOneMilestoneAllowed}">if campaign, can belong to one milestone only</span>      
    </div>
    

    <table class="milestone-panel-table">
      <thead th:with="unbindClause=${(isWritable) ? ', unbind-button=.unbind-milestone-dialog' : ''}">
        <th data-def="select, sWidth=2.5em, map=entity-index">#</th>
        <th data-def="map=label, sortable" th:text="#{label.Label}">label</th>
        <th data-def="map=status, sortable" th:text="#{label.Status}">status</th>
        <th data-def="map=date, sortable" th:text="#{label.EndDate}">end date</th>
        <th data-def="map=description, sortable" th:text="#{label.Description}">description</th>
        <th th:attr="data-def='map=empty-delete-holder '+${unbindClause}" ></th>
      </thead>
      <tbody>
          <!-- initialized via javascript -->
      </tbody>

    </table>

  </div>

    <!-- Bind milestone -->
    
  <div class="bind-milestone-dialog popup-dialog not-displayed" th:title="#{dialog.milestone.bind}">
    <div>
      
      <div class="centered std-margin-top std-margin-bottom" th:if="${conf.nodeType == 'requirement-version'}" >
          <span th:text="#{message.milestones.milestoneUnicityPerRequirementRule}">if requirement version, says that milestones bound to other versions of that requirement 
          will not be associable
          </span>
      </div>

      <table class="bind-milestone-dialog-table" data-def="filter">
        <thead>
          <th data-def="sClass=bind-milestone-dialog-check, map=empty-delete-holder"></th>
          <th data-def="map=label, sortable" th:text="#{label.Label}">label</th>
          <th data-def="map=status, sortable" th:text="#{label.Status}">status</th>
          <th data-def="map=date, sortable" th:text="#{label.EndDate}">end date</th>
          <th data-def="map=description, sortable" th:text="#{label.Description}">description</th>
        </thead>
        <tbody>

        </tbody>
      </table>

      <div class="bind-milestone-dialog-selectors">
        <ul style="list-style-type: none;">
          <li class="clickable-item extra-small-margin-top"><span class="bind-milestone-dialog-selectall"    th:text="#{label.selectAllForSelection}">select all</span></li>
          <li class="clickable-item extra-small-margin-top"><span class="bind-milestone-dialog-selectnone"   th:text="#{label.selectNoneForSelection}">select none</span></li>
          <li class="clickable-item extra-small-margin-top"><span class="bind-milestone-dialog-invertselect" th:text="#{label.invertSelect}">invert selection</span></li>
        </ul>
      </div>      
    </div>

    <div class="popup-dialog-buttonpane" >
      <input th:if="${conf.multilines}" type="button" class="bind-milestone-dialog-confirm" data-def="evt=confirm, mainbtn" th:value="#{label.Confirm}" />
      <input th:if="${not conf.multilines}" type="button" class="bind-milestone-dialog-confirm" data-def="evt=confirm, mainbtn" th:value="#{label.Add}+'/'+#{label.Replace}" />
      <input type="button" class="bind-milestone-dialog-cancel" data-def="evt=cancel" th:value="#{label.Cancel}" />
    </div>

  </div>
  
  <!-- No associated milestone -->
  
  <div class="no-milestone-dialog popup-dialog not-displayed" th:title="#{dialog.milestone.bind.campaign}">
    <div class="display-table-row">
        <div th:include="fragments-utils/static-panels :: warning-pane" th:with="txtcontent=#{title.bindMilestones.noneassociated}"></div>       
    </div>
    <div class="popup-dialog-buttonpane">
      <input type="button" th:value="#{label.Close}"  data-def="evt=close" />
    </div>
  </div>
  
    <!-- Unbind milestone -->
  
  <div class="unbind-milestone-dialog popup-dialog not-displayed" th:title="#{title.unbindMilestones}">
    <div data-def="state=one-selected" class="centered">
        <span class="std-margin" th:text="#{title.unbindMilestones.oneselected}"></span>
    </div>
    <div data-def="state=more-selected" class="centered">
        <span class="std-margin" th:text="#{title.unbindMilestones.moreselected}"></span>
    </div>
    <div data-def="state=none-selected" class="display-table-row">
        <div th:include="fragments-utils/static-panels :: warning-pane" th:with="txtcontent=#{title.unbindMilestones.noneselected}"></div>       
    </div>
        <div data-def="state=one-legacy-selected" class="display-table-row">
        <div th:include="fragments-utils/static-panels :: warning-pane" th:with="txtcontent=#{title.unbindMilestones.legacyselected}"></div>       
    </div>
       
       <div data-def="state=one-statusDontAllowDelete-selected" class="display-table-row">
        <div th:include="fragments-utils/static-panels :: warning-pane" th:with="txtcontent=#{title.unbindMilestones.statusDontAllowDelete}"></div>       
    </div>
    
    
    <div class="popup-dialog-buttonpane">
      <input type="button" th:value="#{label.Confirm}" data-def="state=one-selected more-selected, mainbtn=one-selected more-selected, evt=confirm"/>
      <input type="button" th:value="#{label.Cancel}" data-def="state=one-selected more-selected, mainbtn=one-selected more-selected, evt=cancel"/>
      <input type="button" th:value="#{label.Close}" data-def="state=one-legacy-selected none-selected one-statusDontAllowDelete-selected, mainbtn=one-legacy-selected none-selected one-statusDontAllowDelete-selected, evt=cancel"/>
    </div>
  </div>
  
  <script th:inline="javascript">
  /*<![CDATA[*/
    	var conf = /*[[${conf}]]*/ {};
    	
    	require(["milestones/milestone-panel"], function(panel){
    		panel.init(conf);
    	});
    	
  /*]]>*/
  </script>

</div>

