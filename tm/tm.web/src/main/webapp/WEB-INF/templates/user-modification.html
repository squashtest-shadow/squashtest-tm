<!--

        This file is part of the Squashtest platform.
        Copyright (C) 2010 - 2013 Henix, henix.fr

        See the NOTICE file distributed with this work for additional
        information regarding copyright ownership.

        This is free software: you can redistribute it and/or modify
        it under the terms of the GNU Lesser General Public License as published by
        the Free Software Foundation, either version 3 of the License, or
        (at your option) any later version.

        this software is distributed in the hope that it will be useful,
        but WITHOUT ANY WARRANTY; without even the implied warranty of
        MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
        GNU Lesser General Public License for more details.

        You should have received a copy of the GNU Lesser General Public License
        along with this software.  If not, see <http://www.gnu.org/licenses/>.

-->
<!DOCTYPE html SYSTEM "http://www.thymeleaf.org/dtd/xhtml1-transitional-thymeleaf-spring3-3.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:th="http://www.thymeleaf.org">
<head>
<title th:text="#{workspace.user.info.title}">Espace detail
	utilisateur</title>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<script th:remove="all" type="text/javascript"
	src="../../scripts/lib/jquery/jquery-1.8.3.min.js"></script>
<script th:remove="all" type="text/javascript" src="../../js/thymol.js"></script>
<script type="text/javascript" th:inline="javascript">
	var squashtm = {};
	squashtm.app = {
		contextRoot : /*[[ @{/} ]]*/"http://localhost:8080/squash",
		UMod : {
			user : {
				url : {
					admin : /*[[ @{'/administration/users/'+${user.id}+'/'} ]]*/"/administration/users/1/",
					simple : /*[[ @{'/users/'+${user.id}+'/'} ]]*/"/users/1/",
					changeGroup : /*[[ @{'/administration/users/'+${user.id}+'/change-group'} ]]*/"/administration/users/1/change-group",
				},
				hasAuthentication : /*[[ ${ user.hasAuthentication } ]]*/ true
			},
			users : {
				url : /*[[ @{/administration/users/} ]]*/"/administration/users/",
			},
			message : {
				passSuccess : /*[[ #{user.account.changepass.success} ]]*/"cool it worked ! ",
				error : /*[[ #{popup.title.error} ]]*/"Error",
				empty : /*[[ #{message.AllProjectsAlreadyLinkedToUser} ]]*/"tous les projets sont liés à l'utilisateur",
				userInfoPanelTitle : /*[[ #{user.info.panel.title} ]]*/"Infos Utilisateur",
				permissionsPanelTitle : /*[[ #{user.project-rights.title.label} ]]*/"Permissions",
				richEditPlaceHolder : /*[[#{rich-edit.placeholder}]]*/'(Click to edit ...)',
				okLabel : /*[[ #{label.Ok}]]*/"ok",
				cancelLabel : /*[[ #{label.Cancel} ]]*/'Cancel',
				teamsPanelTitle : /*[[ #{label.teams} ]]*/"teams",
				resetPasswordPopupTitle : /*[[ #{user.account.password.reset.label} ]]*/"reset password",
				confirmLabel : /*[[ #{label.Confirm} ]]*/'Confirmer',
				addPermissionPopupTitle : /*[[#{title.AddPermission}]]*/"add permission",
				addLabel : /*[[#{label.Add}]]*/"add",
				newPassError : /*[[ #{user.account.newpass.error} ]]*/"new Pass Error",
				confirmPassError : /*[[ #{user.account.confirmpass.error} ]]*/"confirm pass error",
				samePassError : /*[[ #{user.account.newpass.differ.error} ]]*/"same pass error",
			},
			permission : {
				url : {
					table : /*[[ @{'/administration/users/'+${user.id}+'/permissions'} ]]*/"/administration/users/1/permissions",
					popup : /*[[ @{'/administration/users/'+${user.id}+'/permission-popup'} ]]*/"/administration/users/1/permission-popup",
					add : /*[[ @{'/administration/users/'+${user.id}+'/add-permission'} ]]*/"/administration/users/1/add-permission",
					remove : /*[[ @{'/administration/users/'+${user.id}+'/remove-permission'} ]]*/"/administration/users/1/remove-permission",
				}
			}

		},

		projectFilterConf : {
			url : /*[[ @{/global-filter/filter} ]]*/'/global-filter/filter',
			title : /*[[ #{dialog.settings.filter.title} ]]*/'Filtre de projets',
			confirmLabel : /*[[ #{label.Confirm} ]]*/'Confirmer',

		},
		menuBarConf : {
			boxSelector : "#menu-toggle-filter-ckbox",
			url : /*[[ @{/global-filter/filter-status} ]]*/'/global-filter/filter-status',
			linkSelector : "#menu-project-filter-link",
			enabledTxt : /*[[ #{workspace.menubar.filter.enabled.label} ]]*/'Actif',
			disabledTxt : /*[[ #{workspace.menubar.filter.disabled.label} ]]*/'Inactif',
			enabledCallbacks : [ function() {
				$("div.tree-filter-reminder-div > span").removeClass(
						"not-displayed");
			} ],
		},
		notificationConf : {
			infoTitle : /*[[ #{popup.title.info} ]]*/'Info',
			errorTitle : /*[[ #{popup.title.error} ]]*/'Erreur'
		},
	};
</script>
<script data-main="../../scripts/user-modification.js" th:attr="data-main=@{/scripts/user-modification.js}"
  src="../../scripts/require.js" th:src="@{/scripts/require-min.js}">
	
</script>
<link rel="stylesheet" type="text/css" media="all" href="../../../../../target/processed-css/squash.core.css"
  sq:css="squash.core.css" />
<link rel="shortcut icon" type="image/x-icon" media="all" href="../../images/favicon.ico"
  th:href="@{/images/favicon.ico}" />
<link rel="stylesheet" type="text/css" media="all" href="../../../../../target/processed-css/squash.grey.css"
  sq:css="squash.grey.css" />
<link rel="stylesheet" type="text/css" media="all" href="../../styles/structure.override.css"
  sq:css="squash.core.override.css" />
<link rel="stylesheet" type="text/css" media="all" href="../../styles/structure.subpageoverride.css"
  sq:css="squash.subpage.override.css" />
</head>
<body>
	<div id="navigation" th:include="navbar.frag :: navbar">NAVBAR</div>
	<div id="workspace">
		<div id="workspace-title">
			<div class="snap-left">
				<h2 th:text="#{label.administration}" class="admin">Administration</h2>
			</div>
			<div class="snap-right">
				<div class="main-menubar " th:include="menubar.frag :: menubar">MENUBAR</div>
				<div class="unstyled-notification-pane"
					th:include="menubar.frag :: notification">NOTIFICATION</div>
			</div>
		</div>
		<div id="sub-page" class="sub-page">

			<div id="sub-page-header"
				class="sub-page-header shadow ui-corner-all">

				<div id="sub-page-title" class="sub-page-title">
					<h2 th:text="#{workspace.user.info.title}">Espace detail user</h2>
				</div>

				<div id="sub-page-buttons" class="sub-page-buttons">

					<input id="back" type="button" th:value="#{ label.Back }"
						value="Back" />

				</div>

				<div class="unsnap"></div>
			</div>

			<div id="sub-page-content"
				class="sub-page-content shadow ui-corner-all">

				<div id="information-content">
					<div id="user-login-div"
						class="ui-widget-header ui-corner-all ui-state-default fragment-header">
						<div class="sub-page-fragment-title">
							<h2>
								<label for="user-login-header" th:text="#{user.header.title}">User</label>
								<a id="team-name-header" href="#" th:text="${user.login}">Machin</a>
							</h2>
						</div>
						<div class="snap-right"></div>
						<div class="unsnap"></div>
					</div>

					<div class="fragment-body unstyled">
						<div id="user-toolbar" class="toolbar-class ui-corner-all ">

							<div th:include="fragments-utils/general-information-panel :: general-information-panel"
								th:with="auditableEntity=${user},entityUrl=@{/users/__${user.id}__}"
								th:remove="tag">
							</div>

							<div class="toolbar-button-panel">
								<input type="button" th:value="#{ user.delete.label }"
									value="Remove" id="delete-user-button" class="button" />
							</div>
						</div>
						<br /> <br />
						<!-- ============================================User Infos ======================================= -->
            <div class="toggle-panel">
              <span class="not-displayed toogle-panel-buttons"></span>
              <div id="user-info-panel" class="information-panel toggle-panel-main">
                <div class="display-table" id="user-infos-table">
                  <div class="display-table-row">
                    <label for="user-login" th:text="#{label.Login}">Login</label>
                    <div id="user-login" class="display-table-cell" th:text="${user.login}">Machin</div>
                  </div>
                  <div class="display-table-row" th:unless="${authenticationProvider.managedPassword}">
                    <label for="reset-password-button" th:text="#{label.password}">Password</label>
                    <div class="display-table-cell">
                      <a  id="reset-password-button" th:text="#{user.button.reset.password}" th:class="${ !user.hasAuthentication } ? 'not-displayed'">Reset</a>
                      <a  id="create-auth-button" th:text="#{label.createPassword}" th:class="${ user.hasAuthentication } ? 'not-displayed'">Create authentication</a>
                    </div>
                  </div>
                  <div class="display-table-row" th:if="${authenticationProvider.managedPassword}">
                    <label for="password-info" th:text="#{label.password}">Password</label>
                    <div class="display-table-cell">
                      <span id="password-info" th:text="#{message.managedPassword}">Managed by auth provider</span>
                    </div>
                  </div>
                  <div class="display-table-row">
                    <label for="user-first-name" th:text="#{label.FirstName}">First name</label>
                    <div id="user-first-name" class="display-table-cell" th:text="${ user.firstName }">Machinou</div>
                  </div>
                  <div class="display-table-row">
                    <label for="user-last-name" th:text="#{label.LastName}">Last Name</label>
                    <div id="user-last-name" class="display-table-cell" th:text="${ user.lastName }">Bidule</div>
                  </div>
                  <div class="display-table-row">
                    <label for="user-email" th:text="#{label.Email}">Email</label>
                    <div id="user-email" class="display-table-cell" th:text="${ user.email }"></div>
                  </div>
                  <div class="display-table-row">
                    <label for="user-group" th:text="#{label.UserGroup}">User Group</label>
                    <div class="display-table-cell">
                      <select id="user-group">
                        <option th:each="group : ${ usersGroupList }" th:id="${group.qualifiedName}"
                          id="squashtest.authz.group.core.Admin" value="1" th:value="${group.id}"
                          th:selected="${ group.simpleName == user.group.simpleName } ? 'selected'"
                          th:text="#{'user.account.group.'+${group.qualifiedName}+'.label'}">Admin</option>
                      </select>
                    </div>
                  </div>
                </div>

              </div>
            </div>
            <!-- ============================================/User Infos ======================================= -->
						<!-- ============================================ Permissions ======================================= -->

						<div id="permissions" class="toggle-panel">
							<span class="not-displayed toggle-panel-buttons"> <input
								id="add-permission-button" th:title="${addButtonTitle}"
								title="add" type="button" value="+" class="button" />
							</span>
							<div id="project-permission-panel" class="toggle-panel-main">
								<table id="permission-table"
									th:attr="data-def='filter, hover,pre-sort=1-asc, datakeys-id=project-id ,ajaxsource='+@{/administration/users/__${user.id}__/permissions}+',language='+@{/datatables/messages}">
									<thead>
										<tr>
											<th th:attr="data-def='select, map=project-index'">#</th>

											<th th:attr="data-def='sortable, map=project-name, filter, link='+@{/administration/projects/{project-id}/info}"
												th:text="#{projects.label}">project</th>
											<th th:attr="data-def='sortable, map=empty-permission-list-holder'"
												th:text="#{project.permission.table.profile.label}">permission</th>
											<th
												th:attr="data-def='delete-button=#remove-permission-dialog, map=empty-delete-holder'">
											</th>
										</tr>
									</thead>
									<tbody>
									<!-- TODO make this prefilled but beware for [Issue 2281] -->
									</tbody>
								</table>
							</div>
						</div>
						<!-- ============================================/ Permissions ======================================= -->
						<!-- ============================================ Teams ======================================= -->

						<div id="teams" class="toggle-panel">
							<span class="not-displayed toggle-panel-buttons"> <input
								type="button" id="add-team-button" value="+"></input> <input
								type="button" id="remove-teams-button"
								th:value="#{label.unsubscribeToTeams}"></input>
							</span>
							<div id="teams-panel" class="toggle-panel-main">

								<table id="teams-table"
									th:attr="data-def='filter, pre-sort=1-asc hover,datakeys-id=team-id ,ajaxsource=' + @{/users/__${user.id}__/teams} + ',language=' + @{/datatables/messages}">
									<thead>
										<tr>
											<th th:attr="data-def='select, map=team-index'">#</th>

											<th
												th:attr="data-def='sortable, map=team-name, filter, link=' + @{/administration/teams/{team-id}}"
												th:text="#{label.team}">team</th>

											<th
												th:attr="data-def='delete-button=#remove-teams-dialog, map=empty-delete-holder'">
											</th>
										</tr>
									</thead>
									<tbody>
									</tbody>
								</table>
							</div>
						</div>

						<!-- ============================================ /Teams ======================================= -->
					</div>
				</div>
			</div>
		</div>
	</div>
	<!--    ====================================POPUPS======================================================  -->

  <div id="pass-pop-pane" class="not-displayed"></div>
  <div id="auth-pop-pane" class="not-displayed"></div>
  <script id="password-reset-popup-tpl" type="text/x-handlebars-template" th:inline="text">
	<div id="{{popupId}}" class="not-displayed popup-dialog" th:unless="${authenticationProvider.managedPassword}">
		<div id="user-account-password-panel">

			<div>
				<label th:text="#{user.account.newpass.label}">new passwd</label> <input
					type="password" class="password" /> <span
					class="error-message password-error"></span>
			</div>

			<div>
				<label th:text="#{user.account.confirmpass.label}">confirm
					passwd</label> <input type="password" class="user-account-confirmpass" /> <span
					class="error-message user-account-confirmpass-error"></span>
			</div>

		</div>
		<span class="error-message user-account-changepass-status-error"></span>
	</div>
  </script>

	<div id="remove-teams-dialog" class="popup-dialog not-displayed"
		th:title="#{title.unsubscribeToTeams}">
		<div th:text="#{message.unsubscribeToTeams}">?</div>
		<div class="popup-dialog-buttonpane">
			<input class="confirm" type="button" value="confirm"
				th:value="#{label.Confirm}" /> <input class="cancel" type="button"
				value="cancel" th:value="#{label.Cancel}" />
		</div>
	</div>

	<div id="no-selected-teams" class="popup-dialog not-displayed"
		th:title="#{popup.title.error}">
		<span th:text="#{message.noTeamSelected}"></span>
	</div>


	<div id="add-team-dialog" class="not-displayed popup-dialog"
		title="Add Team" th:title="#{title.subscribeToTeam}">
		<div class="main">
			<label for="add-teams-input" th:text="#{label.team}">which
				one </label> <input type="text" id="add-team-input" />
		</div>
		<div class="wait please-wait-message waiting-loading"
			th:text="#{message.PleaseWait}">zzz</div>
		<div class="no-more-teams"
			th:text="#{message.allTeamsAlreadyLinkedToUser}">no more teams
			to bind</div>
		<div class="no-selected-teams" th:text="#{message.noTeamSelected}"></div>
		<div class="popup-dialog-buttonpane">
			<input class="confirm" type="button" value="confirm"
				th:value="#{label.Confirm}" /> <input class="cancel" type="button"
				value="cancel" th:value="#{label.Cancel}" />
		</div>
	</div>

	<div id="remove-permission-dialog" class="popup-dialog not-displayed"
		th:title="#{title.RemovePermission}">
		<div th:text="#{message.permissions.remove}"></div>
		<div class="popup-dialog-buttonpane">
			<input class="confirm" type="button" value="confirm"
				th:value="#{label.Confirm}" /> <input class="cancel" type="button"
				value="cancel" th:value="#{label.Cancel}" />
		</div>
	</div>
	
	<div id="delete-user-dialog" class="popup-dialog not-displayed" th:title="#{tooltips.delete-user}">
		<div th:text="#{dialog.delete-user.message}"></div>
		<div class="popup-dialog-buttonpane">
			<input class="confirm" type="button" value="confirm"
				th:value="#{label.Confirm}" /> <input class="cancel" type="button"
				value="cancel" th:value="#{label.Cancel}" />
		</div>	
	</div>

	<div id="delete-warning-pane" class="not-displayed popup-dialog"
		title="Delete" th:title="#{label.Remove}">
		<div class="alert">
			<span th:text="#{message.user.remove}">Do you wanna remove
				user ?</span>
		</div>
		<div class="popup-dialog-buttonpane">
			<input class="confirm" type="button" value="Proceed"
				th:value="#{label.Confirm}" /> <input class="cancel" type="button"
				value="Cancel" th:value="#{label.Cancel}" />
		</div>
	</div>

	<div id="add-permission-dialog" class="not-displayed popup-dialog"
		title="AddPermission" th:title="#{title.AddPermission}">
		<div class="main">
			<table id="add-permission-dialog-table">
				<tr>
					<td><label th:text="#{label.project}"></label></td>
					<td><select id="project-input">
							<option th:each="myproject : ${projectList}"
								th:value="${myproject.id}" th:id="${myproject.name}"
								th:text="${myproject.name}">Nom</option>
					</select></td>
				</tr>
	
				<tr>
					<td><label th:text="#{label.Permission}"></label></td>
					<td><select id="permission-input">
							<option th:each="permission : ${permissionList}"
								th:value="${permission.qualifiedName}"
								th:id="${permission.simpleName}"
								th:text="#{'user.project-rights.'+${permission.simpleName}+'.label'}">
							</option>
					</select></td>
				</tr>
			</table>
		</div>
		<div class="wait please-wait-message waiting-loading"
			th:text="#{message.PleaseWait}">zzz</div>
		<div class="no-more-projects"
			th:text="#{message.AllProjectsAlreadyLinkedToUser}">no more teams
			to bind
		</div>
		<div class="popup-dialog-buttonpane">
			<input class="confirm" type="button" value="confirm"
				th:value="#{label.Confirm}" /> <input class="cancel" type="button"
				value="cancel" th:value="#{label.Cancel}" />
		</div>
	</div>
</body>
</html>
